// Dizionario dei termini sanitari con tutte le voci richieste (senza descrizione)
const dizionarioSanitario = [
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "BASTONI CANADESI",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Bastoni da deambulazione"
    },
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "BUSTO O CORSETTO ORTOPEDICO",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Bustino ortopedico, Corsetto, Tutore del tronco"
    },
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "CALZATURE ORTOPEDICHE",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Bustino ortopedico, Corsetto, Tutore del tronco"
    },
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Calze o gambaletti elastici",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Calze elastiche, Calze a compressione, Calze terapeutiche"
    },
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Carrozzina per deambulazione",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Carrozzella, Sedia a rotelle"
    },
        {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Cavigliera elastica",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Tutore elastico di caviglia"
    },
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Cinto erniario",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Pancera, Fascia addominale"
    },
    {
        cod: "5PORT",
        tipologia: "Collare cervicale",
        termine: "Calze o gambaletti elastici",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Tutore cervicale, Collare ortopedico"
    },
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Cuscino ortopedico",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Cuscino da seduta"
    },
        {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Divaricatore",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Tutore divaricatore"
    },
    {
        cod: "5PORT",
        tipologia: "Ginocchiere",
        termine: "Calze o gambaletti elastici",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Tutore del ginocchio"
    },
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Mutanda contenitiva",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Mutanda elastica, Pancera contenitiva"
    },
            {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Divaricatore",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Tutore divaricatore"
    },
    {
        cod: "5PORT",
        tipologia: "Plantari ortopedici",
        termine: "Calze o gambaletti elastici",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Solette ortopediche"
    },
    {
        cod: "5PORT",
        tipologia: "Termine sanitario",
        termine: "Rialzo calcaneare",
        categoria: "Presidi ortopedici acquisto",
        rimborso: "20%",
        maxSpec: "300eur 3 anni ad avente diritto",
        maxGrup: "maxspec",
        preventivoPrescrizione: "Si",
        opt: "No",
        visitaIniziale: "No",
        visitaFinale: "No",
        valutazioneSanitaria: "No",
        sinonimi: "Tallonetta, Zeppa calcaneare"
    },
    {
        cod: "EST010",
        tipologia: "Esame Strumentale",
        termine: "TAC",
        categoria: "esami",
        rimborso: "70%",
        maxSpec: "1 all'anno",
        maxGrup: "N/A",
        preventivoPrescrizione: "Obbligatoria",
        opt: "Si",
        visitaIniziale: "No",
        visitaFinale: "Si",
        valutazioneSanitaria: "Referto radiologico",
        sinonimi: "Tomografia computerizzata, SCAN"
    }
];

// Elementi DOM
const searchInput = document.getElementById('searchInput');
const searchButton = document.getElementById('searchButton');
const resultsContainer = document.getElementById('resultsContainer');
const categoryButtons = document.querySelectorAll('.category-btn');
const termsCount = document.getElementById('termsCount');
const selectedCategory = document.getElementById('selectedCategory');

// Variabili per filtri
let currentSearchTerm = '';
let currentCategory = 'all';

// Inizializza la visualizzazione
displayTerms(dizionarioSanitario);
updateStats(dizionarioSanitario.length);

// Event listeners
searchInput.addEventListener('input', function() {
    currentSearchTerm = this.value.toLowerCase();
    filterTerms();
});

searchButton.addEventListener('click', () => {
    currentSearchTerm = searchInput.value.toLowerCase();
    filterTerms();
});

categoryButtons.forEach(button => {
    button.addEventListener('click', function() {
        // Rimuovi la classe active da tutti i pulsanti
        categoryButtons.forEach(btn => btn.classList.remove('active'));
        // Aggiungi la classe active al pulsante cliccato
        this.classList.add('active');
        
        currentCategory = this.getAttribute('data-category');
        selectedCategory.textContent = `Categoria: ${getCategoryLabel(currentCategory)}`;
        filterTerms();
    });
});

// Funzione per filtrare i termini in base alla ricerca e alla categoria
function filterTerms() {
    let filteredTerms = dizionarioSanitario;
    
    // Filtra per categoria
    if (currentCategory !== 'all') {
        filteredTerms = filteredTerms.filter(term => term.categoria === currentCategory);
    }
    
    // Filtra per termine de ricerca
    if (currentSearchTerm) {
        filteredTerms = filteredTerms.filter(term => 
            term.termine.toLowerCase().includes(currentSearchTerm) ||
            term.sinonimi.toLowerCase().includes(currentSearchTerm) ||
            term.cod.toLowerCase().includes(currentSearchTerm) ||
            term.tipologia.toLowerCase().includes(currentSearchTerm)
        );
    }
    
    displayTerms(filteredTerms);
    updateStats(filteredTerms.length);
}

// Funzione per visualizzare i termini
function displayTerms(terms) {
    resultsContainer.innerHTML = '';
    
    if (terms.length === 0) {
        resultsContainer.innerHTML = '<div class="no-results">Nessun risultato trovato. Prova con un\'altra ricerca.</div>';
        return;
    }
    
    terms.forEach(term => {
        const termCard = document.createElement('div');
        termCard.classList.add('term-card');
        
        // Evidenziazione del testo cercato
        const highlightText = (text, search) => {
            if (!search || !text) return text || '';
            const regex = new RegExp(`(${search})`, 'gi');
            return text.toString().replace(regex, '<span class="highlight">$1</span>');
        };
        
        termCard.innerHTML = `
            <h3 class="term-name">${highlightText(term.termine, currentSearchTerm)}</h3>
            <p class="term-detail"><span class="detail-label">COD:</span> ${highlightText(term.cod, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Tipologia:</span> ${highlightText(term.tipologia, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Categoria:</span> ${getCategoryLabel(term.categoria)}</p>
            <p class="term-detail"><span class="detail-label">Rimborso:</span> ${highlightText(term.rimborso, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Max Spec:</span> ${highlightText(term.maxSpec, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Max Grup:</span> ${highlightText(term.maxGrup, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Preventivo-Prescrizione:</span> ${highlightText(term.preventivoPrescrizione, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">OPT:</span> ${highlightText(term.opt, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Visita Iniziale:</span> ${highlightText(term.visitaIniziale, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Visita Finale:</span> ${highlightText(term.visitaFinale, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Valutazione Sanitaria:</span> ${highlightText(term.valutazioneSanitaria, currentSearchTerm)}</p>
            <p class="term-detail"><span class="detail-label">Sinonimi:</span> ${highlightText(term.sinonimi, currentSearchTerm)}</p>
        `;
        
        resultsContainer.appendChild(termCard);
    });
}

// Funzione per aggiornare le statistiche
function updateStats(count) {
    termsCount.textContent = `${count} termini trovati`;
}
    return labels[category] || category;
}
